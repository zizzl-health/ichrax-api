openapi: 3.0.3
info:
  title: ICHRAX API
  version: 1.0.0
  description: >-
    API for ICHRA marketplace integrations. This draft includes a snapshot ingestion
    endpoint allowing partners to POST batches of employee enrollment snapshots.
    Reference identifier fields (partnerReferenceId, internalEmployeeId, externalEmployeeId)
    are placeholders and may be renamed or further constrained once partner contract
    details are finalized.
paths:
  /member-snapshots:
    post:
      summary: Create Member Snapshots
      description: >-
        Accepts an array of employee enrollment snapshot objects representing an employee (primary) and any dependents and the plan they are enrolled in. Reference identifier fields are placeholders (TBD) for partner and internal linking.
      operationId: createMemberSnapshot
      tags:
        - Member Snapshots
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: array
              items:
                $ref: '#/components/schemas/InboundMemberSnapshot'

      responses:
        '200':
          description: Successful Response - Returns the Job ID for tracking
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OutboundMemberSnapshotJobID'                
        '400':
          description: Failure Response - Client error
          content:
            application/json:
              schema:
                type: object
              examples:
                example:
                  value:
                    message: >-
                      Error creating dependent. Existing dependent has matching name and date of birth: ab740704-7c37-4010-92b3-d22c6926be3e
                    status: 400
        '404':
          description: Failure Response - Not found error
          content:
            application/json:
              schema:
                type: object
              examples:
                example:
                  value:
                    message: >-
                      Dependent with ID ab740704-7c37-4010-92b3-d22c6926be3e does not have an associated employee.
                    status: 404
        '422':
          description: Failure Response - Schema validation error
          content:
            application/json:
              schema:
                type: object
      deprecated: false
  /member-snapshots/job/{jobId}:
    get:
      summary: Get snapshot job processing status
      description: >-
        Returns current processing status for a previously submitted enrollment snapshot job.
        Optionally include per-item statuses. Job statuses may evolve through states such as
        RECEIVED -> VALIDATING -> PROCESSING -> COMPLETED (or FAILED). Implementations may
        expand status values; clients should treat unknown values as non-terminal unless documented otherwise.
      operationId: getSnapshotBatchStatus
      parameters:
        - name: jobId
          in: path
          description: Identifier returned from the original job submission.
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Multi-status response for a processed member snapshot job.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MultiStatusMemberSnapshotJob'
              examples:
                multiStatusExample:
                  summary: Example multi-status job response
                  value:
                    job_id: 497d98f3-580a-4ab9-830a-af2346d029b2
                    status: complete
                    body:
                      - individual_transaction_id: 430f9d95-1dcf-4b99-b616-45f814416890
                        code: 201
                        message: Successfully enrolled individual in benefit
                      - individual_transaction_id: 647975ac-1e0f-4e9c-b705-e3042da48581
                        code: 200
                        message: Successfully updated enrollment for individual
                      - individual_transaction_id: 4a0a3b15-d3d6-41c2-a4a4-ca4ed1b68cf8
                        code: 404
                        message: Individual not found
        '400':
          description: Invalid batchId format or unsupported query combination
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ValidationError'
              examples:
                invalidId:
                  summary: Invalid batchId format
                  value:
                    message: Validation failed
                    errors:
                      - path: 'batchId'
                        code: pattern
                        message: batchId format invalid
        '404':
          description: Batch not found
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              examples:
                notFound:
                  summary: Unknown batch
                  value:
                    message: Batch not found
        '500':
          description: Server error
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
              examples:
                serverError:
                  summary: Unexpected error
                  value:
                    message: Unexpected server error
      tags:
        - Member Snapshots

components:
  schemas:
    ValidationError:
      type: object
      properties:
        message:
          type: string
        errors:
          type: array
          items:
            type: object
            properties:
              path:
                type: string
              code:
                type: string
              message:
                type: string

    InboundMemberSnapshot:
      type: object
      description: Inbound member snapshot payload.
      properties:
        individual_transaction_id:
          description: A unique identifier for the transaction.
          minLength: 1
          type: string
        partner_individual_id:
          description: ID of the primary individual (employee) from the partner system.
          minLength: 1
          type: string
        partner_organization_id:
          description: ID of the related organization/employer from the partner system.
          minLength: 1
          type: string
        coverage:
          $ref: '#/components/schemas/InboundMemberSnapshotCoverage'
          description: Coverage and enrollment decisions for each member
        dependents:
          type: array
          description: List of demographic information for each dependent
          items:
            $ref: '#/components/schemas/InboundMemberSnapshotDependent'
        employee:
          $ref: '#/components/schemas/InboundMemberSnapshotEmployee'
          description: Demographic information for the employee
        events:
          type: array
          description: List of events associated with member and coverage updates
          items:
            $ref: '#/components/schemas/InboundMemberSnapshotEvent'
      required: [employee, individual_transaction_id, partner_individual_id, partner_organization_id, coverage]
      additionalProperties: false
    OutboundMemberSnapshotJobID:
      type: object
      description: Outbound representation of a member snapshot after processing.
      properties:         
        job_id:
          type: string
          format: uuid
          description: Unique identifier of the job
      required: [job_id]
      additionalProperties: false
    MultiStatusMemberSnapshotJob:
      type: object
      description: Aggregated multi-status result for a submitted member snapshot job.
      properties:
        job_id:
          type: string
          format: uuid
          description: Unique identifier of the job.
        status:
          type: string
          description: Overall processing status of the job.
          enum: [pending, processing, complete, error]
        body:
          type: array
          description: Per-snapshot outcome details.
          items:
            $ref: '#/components/schemas/MultiStatusMemberSnapshotJobItem'
      required: [job_id, status, body]
      additionalProperties: false
    MultiStatusMemberSnapshotJobItem:
      type: object
      description: Outcome for an individual snapshot within the job.
      properties:
        individual_transaction_id:
          type: string
          format: uuid
          description: Identifier for the individual snapshot transaction.
        code:
          type: integer
          description: HTTP-like status code representing the outcome.
        message:
          type: string
          description: Human-readable message describing the outcome.
      required: [individual_transaction_id, code, message]
      additionalProperties: false
    InboundMemberSnapshotAddress:
      properties:
        city:
          description: City of the address
          example: Bend
          type: string
        county:
          description: County of the address
          example: Deschutes
          type: string
        state:
          description: State postal code of the address
          enum: [AL, AK, AZ, AR, CA, CO, CT, DE, DC, FL, GA, HI, ID, IL, IN, IA, KS, KY, LA, ME, MD, MA, MI, MN, MS, MO, MT, NE, NV, NH, NJ, NM, NY, NC, ND, OH, OK, OR, PA, RI, SC, SD, TN, TX, UT, VT, VA, WA, WV, WI, WY, AS, GU, MH, FM, MP, PW, PR, VI, UM]
          example: OR
          type: string
        street_one:
          description: Line one of the address
          example: 339 Hickory Street
          type: string
        street_two:
          description: Line two of the address
          example: Apartment 5
          type: string
        zip_code:
          description: Zip code of the address
          example: '97701'
          type: string
      required: [city, state, street_one, zip_code]
      type: object
    InboundMemberSnapshotCoverage:
      properties:
        carrier_specific_config:
          description: Enrollment classifications required by the carrier
          type: object
        carrier_id:
          description: Carrier ID associated with this coverage
          format: uuid
          type: string
        carrier_plan_id:
          description: Carrier specific plan ID.
          minLength: 1
          type: string
        enrolled_members:
          description: Employee and dependent members enrolling in this coverage
          items:
            $ref: '#/components/schemas/InboundMemberSnapshotEnrolledMember'
          type: array
        plan_hios_id:
          description: The unique ID of the plan associated with this coverage.
          format: uuid
          type: string
        agent:
          description: Writing agent details associated with this coverage
          type: object
          properties:
            first_name:
              type: string
              description: Agent first name
            last_name:
              type: string
              description: Agent last name
            street_one:
              type: string
              description: Agent address line one
            street_two:
              type: string
              description: Agent address line two
            city:
              type: string
              description: Agent city
            state:
              type: string
              description: Agent state postal code
              enum: [AL, AK, AZ, AR, CA, CO, CT, DE, DC, FL, GA, HI, ID, IL, IN, IA, KS, KY, LA, ME, MD, MA, MI, MN, MS, MO, MT, NE, NV, NH, NJ, NM, NY, NC, ND, OH, OK, OR, PA, RI, SC, SD, TN, TX, UT, VT, VA, WA, WV, WI, WY, AS, GU, MH, FM, MP, PW, PR, VI, UM]
            zip_code:
              type: string
              description: Agent ZIP code
            npn:
              type: string
              description: National Producer Number
            phone:
              type: string
              description: Agent phone number (E.164 or national format)
            email_address:
              type: string
              format: email
              description: Agent email address
            carrier_id:
              type: string
              format: uuid
              description: Carrier identifier associated with this agent (if carrier-specific)
        agency:
          description: Agency details associated with this coverage
          type: object
          properties:
            first_name:
              type: string
              description: Agency contact first name
            last_name:
              type: string
              description: Agency contact last name
            street_one:
              type: string
              description: Agency address line one
            street_two:
              type: string
              description: Agency address line two
            city:
              type: string
              description: Agency city
            state:
              type: string
              description: Agency state postal code
              enum: [AL, AK, AZ, AR, CA, CO, CT, DE, DC, FL, GA, HI, ID, IL, IN, IA, KS, KY, LA, ME, MD, MA, MI, MN, MS, MO, MT, NE, NV, NH, NJ, NM, NY, NC, ND, OH, OK, OR, PA, RI, SC, SD, TN, TX, UT, VT, VA, WA, WV, WI, WY, AS, GU, MH, FM, MP, PW, PR, VI, UM]
            zip_code:
              type: string
              description: Agency ZIP code
            phone:
              type: string
              description: Agency phone number (E.164 or national format)
            email_address:
              type: string
              format: email
              description: Agency email address
            tin:
              type: string
              description: Agency Tax Identification Number
            carrier_id:
              type: string
              format: uuid
              description: Carrier identifier associated with this agency (if carrier-specific)
        payment:
          description: Payment information for this coverage's premium
          type: object
          properties:
            monthly_premium:
              type: number
              description: Monthly premium amount in USD
              example: 123.45
            billing_address:
              type: object
              description: Billing address for premium payments
              properties:
                street_one:
                  type: string
                street_two:
                  type: string
                city:
                  type: string
                state:
                  type: string
                  enum: [AL, AK, AZ, AR, CA, CO, CT, DE, DC, FL, GA, HI, ID, IL, IN, IA, KS, KY, LA, ME, MD, MA, MI, MN, MS, MO, MT, NE, NV, NH, NJ, NM, NY, NC, ND, OH, OK, OR, PA, RI, SC, SD, TN, TX, UT, VT, VA, WA, WV, WI, WY, AS, GU, MH, FM, MP, PW, PR, VI, UM]
                zip_code:
                  type: string
            credit_card:
              type: object
              description: Credit card payment details (if card is payment method)
              properties:
                card_type:
                  type: string
                  description: Card network / type (e.g., visa, mastercard)
                card_holder_name:
                  type: string
                card_number:
                  type: string
                  description: PAN (should be tokenized in production systems)
                expiration_date:
                  type: string
                  description: Expiration in MM/YY or YYYY-MM format
                security_code:
                  type: string
                  description: Card security code (CVV/CVC) - avoid storing in persistent systems
            bank_account:
              type: object
              description: Bank account payment details (if ACH is payment method)
              properties:
                account_type:
                  type: string
                  description: Type of bank account (e.g., checking, savings)
                account_holder_name:
                  type: string
                routing_number:
                  type: string
                account_number:
                  type: string
      required: [carrier_id, plan_hios_id, enrolled_members]
      type: object
    InboundMemberSnapshotDependent:
      properties:
        partner_individual_id:
          description: Custom ID of the Dependent from partner system.
          minLength: 1
          type: string
        person:
          $ref: '#/components/schemas/InboundMemberSnapshotPerson'
          description: Personal information for the dependent
        relationship:
          description: Relationship of the dependent to the employee
          enum: [spouse, child, domestic-partner]
          type: string
      required: [person, relationship]
      type: object
    InboundMemberSnapshotEmployee:
      properties:
        partner_individual_id:
          description: Custom ID of the Employee from partner system.
          minLength: 1
          type: string
        employment:
          $ref: '#/components/schemas/InboundMemberSnapshotEmployment'
          description: Employment information for the employee
        person:
          $ref: '#/components/schemas/InboundMemberSnapshotPerson'
          description: Personal information for the employee
      required: [employment, person]
      type: object
    InboundMemberSnapshotEmployment:
      properties:
        employment_dates:
          $ref: '#/components/schemas/InboundMemberSnapshotEmploymentDates'
          description: Employee employment dates
        employment_status:
          description: Employee employment status
          enum: [full-time, part-time, contract, disabled, terminated, retired]
          type: string
        hours_worked:
          description: An integer of hours worked per week by the employee
          example: 40
          format: int32
          type: integer
        occupation:
          description: Employee occupation or job title
          example: Engineer
          type: string
        salary:
          $ref: '#/components/schemas/InboundMemberSnapshotSalary'
          description: Employee salary information
      required: [employment_dates, employment_status, hours_worked]
      type: object
    InboundMemberSnapshotEmploymentDates:
      properties:
        full_time_start:
          description: ISO-8601 date string for start date as a full time employee with the group (if applicable)
          example: '2017-01-17'
          type: string
        hire_date:
          description: ISO-8601 date string for the hire date of the employee
          example: '2017-01-17'
          format: date
          type: string
        rehire:
          description: ISO-8601 date string for the rehire date of the employee (if applicable)
          example: '2018-02-01'
          type: string
        retirement:
          description: ISO-8601 date string for the retirement date of the employee (if applicable)
          example: '2019-01-01'
          type: string
        terminated:
          description: ISO-8601 date string for the termination date of the employee (if applicable)
          example: '2018-01-01'
          type: string
      required: [hire_date]
      type: object
    InboundMemberSnapshotEnrolledMember:
      properties:
        effective_end_date:
          description: Effective end date of coverage for the member
          example: '9999-12-31'
          format: date
          type: string
        effective_start_date:
          description: Original effective start date of coverage for the member
          example: '2021-01-01'
          format: date
          type: string
        event_id:
          description: The unique ID of an event from the snapshot events list
          example: '1'
          minLength: 1
          type: string
        partner_individual_id:
          description: Unique ID of the employee or dependent from the snapshot
          format: uuid
          nullable: true
          type: string
        pcp_details:
          $ref: '#/components/schemas/InboundMemberSnapshotPCPDetails'
          description: Details about primary care providers
      required: [partner_individual_id, effective_end_date, effective_start_date]
      type: object
    InboundMemberSnapshotEvent:
      properties:
        date:
          description: The date the event occurred
          format: date
          type: string
        id:
          description: Unique ID for the event, used internally in this payload
          minLength: 1
          type: string
        reason:
          description: The cause or real world scenario described in the event
          enum: []
          type: string
        type:
          description: The type or category of member change made due to this event
          enum: [coverage, demographic]
          type: string
      required: [date, id, reason, type]
      type: object
    InboundMemberSnapshotPCPDetails:
      properties:
        providers:
          description: List of primary care providers
          items:
            $ref: '#/components/schemas/InboundMemberSnapshotPrimaryCareProvider'
          type: array
      required: [providers]
      type: object
    InboundMemberSnapshotPerson:
      properties:
        contact:
          $ref: '#/components/schemas/InboundMemberSnapshotPersonContact'
          description: Contact information for the person
        date_of_birth:
          description: ISO-8601 date string for the date of birth of the person
          example: '1977-06-03'
          format: date
          type: string
        details:
          $ref: '#/components/schemas/InboundMemberSnapshotPersonDetails'
          description: Additional personal details of the person
        first_name:
          description: First name of the person
          example: Catherine
          type: string
        home_address:
          $ref: '#/components/schemas/InboundMemberSnapshotAddress'
          description: Home address of the person
        last_name:
          description: Last name of the person
          example: Briggs
          type: string
        mailing_address:
          $ref: '#/components/schemas/InboundMemberSnapshotAddress'
          description: Mailing address of the person
        marital_status:
          description: Marital status of the person
          enum: [single, married, domestic-partner, divorced, widowed, legally-separated]
          example: married
          type: string
        middle_name:
          description: Middle name of the person
          example: S
          type: string
        sex:
          description: Sex of the person
          enum: [F, M, U, X]
          example: F
          type: string
        ssn:
          description: Social Security Number of the person
          example: '123456789'
          nullable: true
          type: string
        suffix:
          description: Suffix of the person
          type: string
      required: [date_of_birth, first_name, home_address, last_name, mailing_address, sex]
      type: object
    InboundMemberSnapshotPersonContact:
      properties:
        email_address:
          description: Email address of the person
          example: catherine.briggs@example.com
          format: email
          nullable: true
          type: string
        email_address_type:
          description: Type of email address
          enum: [home, work]
          example: home
          type: string
        home_phone:
          description: Home phone number in E.164 format
          example: '+15555551212'
          type: string
        preferred_language:
          description: Preferred written or spoken language of the person
          example: English
          type: string
        preferred_method:
          description: Preferred method of contact for the person
          enum: [mail, email, home-phone, work-phone, other]
          example: email
          type: string
        work_phone:
          description: Work phone number in E.164 format
          example: '+15555551212'
          type: string
      type: object
    InboundMemberSnapshotPersonDetails:
      properties:
        disability:
          $ref: '#/components/schemas/InboundMemberSnapshotPersonDisability'
          description: Disability details (if applicable)
        is_military:
          description: True if the person is in the military
          type: boolean
        is_student:
          description: True if the person is a student
          type: boolean
        tobacco:
          $ref: '#/components/schemas/InboundMemberSnapshotPersonTobacco'
          description: Tobacco usage details (if applicable)
      type: object
    InboundMemberSnapshotPersonDisability:
      properties:
        communication:
          description: True if the disability impacts the ability to communicate or read
          type: boolean
        disabled:
          description: True if the member has a disability
          type: boolean
      type: object
    InboundMemberSnapshotPersonTobacco:
      properties:
        duration:
          description: Duration of tobacco use
          example: 5 years
          type: string
        user:
          description: True if the person uses tobacco of any kind
          example: true
          type: boolean
      type: object
    InboundMemberSnapshotPrimaryCareProvider:
      properties:
        entity_identifier_code:
          description: Code of the entity identifier
          enum: [pcp, obgyn]
          type: string
        entity_type:
          description: Type of entity
          enum: [person, non_person_entity]
          type: string
        first_name:
          description: First name of the primary care provider
          type: string
        identification_code:
          description: Code of the identification
          type: string
        identification_code_type:
          description: Type of the identification code
          enum: [service_provider_number, national_provider_identifier]
          type: string
        last_name:
          description: Last name of the primary care provider
          type: string
        middle_name:
          description: Middle name of the primary care provider
          type: string
        organization_name:
          description: Organization name of the primary care provider.
          type: string
        patient_relationship_code:
          description: Code which represents the relationship of the patient to the primary care provider
          enum: [established, not_established, unknown]
          type: string
      required: [identification_code, identification_code_type]
      type: object
    InboundMemberSnapshotSalary:
      properties:
        amount:
          description: Amount of salary earned by the employee in US dollars and cents, as a decimal value
          example: 52000
          minimum: 0
          type: number
        effective_date:
          description: The ISO-8601 date-string the current employee salary is effective
          example: '2022-02-01'
          type: string
        type:
          description: Type of salary earned by the employee
          enum: [hourly, salary]
          example: salary
          type: string
        unit:
          description: Unit of salary earned by the employee
          enum: [annual, month, semi-monthly, week, hour]
          example: annual
          type: string
      type: object
   
